<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∞Ö... ‡∞Ü... KidSpace</title>
    <style>
        /*
        =========================================================
        1. Base Styles & Color Palette (General UI Guidelines)
        =========================================================
        */
        :root {
            /* Color Palette: orange (#FF8A00), cream, pastel blue, soft green. */
            --color-peach: #FFF7E6;
            --color-cream: #FFE0B2;
            --color-orange: #FF8A00;
            --color-pastel-blue: #B3E0FF;
            --color-soft-green: #C8E6C9;
            --color-text-dark: #333;
            --color-text-light: #fff;
            --font-family: 'Quicksand', 'Nunito', sans-serif;
            
            /* New specific colors for learning zones */
            --color-epic-red: #E85D04;
            --color-history-lavender: #E0BBE4;
            --color-science-green: #95D5B2;
            --color-grammar-blue: #A2D2FF;
            --color-light-pink: #FFC0CB;
            --color-story-purple: #C9A0DC;
            --color-maths-yellow: #FFD93D;
            --color-elearning-teal: #2EC4B6; /* New color for E-Learning */
        }

        body {
            margin: 0;
            font-family: var(--font-family);
            color: var(--color-text-dark);
            background-color: var(--color-peach);
            overflow-x: hidden;
        }

        /* General Container for all screens (mobile-first) */
        .app-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            /* Hide all pages by default, JS will show one */
            display: none;
            width: 100%;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .app-screen {
                padding: 15px;
            }
            .btn {
                padding: 12px 24px;
                font-size: 1em;
            }
            .activity-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 15px;
            }
            .activity-card {
                padding: 20px;
                font-size: 1em;
            }
            .activity-card-icon {
                font-size: 3.5em;
            }
            .video-card {
                padding: 25px;
                margin-bottom: 25px;
            }
            .play-button {
                width: 50px;
                height: 50px;
                font-size: 2em;
            }
            .splash-logo {
                font-size: 4em;
            }
            .login-card {
                padding: 25px;
                max-width: 90%;
            }
            .dashboard-card {
                padding: 20px;
            }
            .video-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 20px;
            }
            .home-content {
                padding: 25px;
            }
            .home-content h1 {
                font-size: 2em;
                margin-bottom: 20px;
            }
            .home-content h2 {
                font-size: 1.4em;
                margin-bottom: 15px;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .activity-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
            .splash-logo {
                font-size: 4.5em;
            }
            .video-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
            .home-content {
                padding: 30px;
            }
            .home-content h1 {
                font-size: 2em;
            }
            .home-content h2 {
                font-size: 1.4em;
            }
            .activity-grid {
                gap: 18px;
            }
            .activity-card {
                padding: 18px;
            }
            .video-card {
                padding: 22px;
            }
        }

        @media (min-width: 1025px) {
            .activity-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
            .splash-logo {
                font-size: 5em;
            }
            .video-grid {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            }
            .home-content {
                padding: 50px;
                max-width: 1400px;
                margin: 0 auto;
            }
            .home-content h1 {
                font-size: 2.5em;
            }
            .home-content h2 {
                font-size: 1.6em;
                margin-bottom: 20px;
            }
            .activity-grid {
                gap: 25px;
            }
            .activity-card {
                padding: 20px;
                font-size: 1em;
            }
            .activity-card-icon {
                font-size: 3.5em;
            }
            .video-card {
                padding: 30px;
                margin-bottom: 30px;
            }
            .play-button {
                width: 60px;
                height: 60px;
                font-size: 2.5em;
            }
            .dashboard-card {
                padding: 25px;
            }
        }
        
        /* Show the active screen */
        .app-screen.active {
            display: flex;
        }

        /* Buttons: large, pill-shaped, shadowed, hover and tap animations. */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background-color: var(--color-orange);
            color: var(--color-text-light);
        }
        
        .btn-secondary {
            background-color: var(--color-cream);
            color: var(--color-orange);
        }

        /* Rounded Inputs */
        input[type="email"],
        input[type="password"],
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid var(--color-cream);
            border-radius: 12px;
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.2s;
        }
        
        input:focus,
        select:focus {
            outline: none;
            border-color: var(--color-orange);
        }

        /*
        =========================================================
        2. Splash Page Styles (index.html or /)
        =========================================================
        */
        #splash-screen {
            background: linear-gradient(180deg, var(--color-peach) 0%, var(--color-cream) 100%);
            justify-content: center;
            align-items: center;
            text-align: center;
            animation: fadeIn 1s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .splash-logo {
            font-size: 5em;
            color: var(--color-orange);
            font-weight: 900;
            margin-bottom: 20px;
            /* Simple bounce/fade-in animation */
            animation: logoBounce 2s infinite alternate, logoFadeIn 1.5s ease-out;
        }

        @keyframes logoFadeIn {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes logoBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .splash-tagline {
            max-width: 300px;
            margin: 20px auto 40px;
            font-size: 1.1em;
            line-height: 1.4;
            color: #666;
        }

        .splash-lottie-placeholder {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            background-color: var(--color-pastel-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            color: var(--color-text-dark);
            /* Simulating a looping animation */
            animation: pulse 2s infinite alternate;
        }

        @keyframes pulse {
            from { opacity: 0.8; }
            to { opacity: 1; }
        }

        /*
        =========================================================
        3. Login Page Styles
        =========================================================
        */
        #login-screen {
            justify-content: flex-start;
            padding-top: 50px;
            background-color: var(--color-peach);
        }

        .login-card {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 400px;
            margin: auto;
        }

        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
        }

        .tab-buttons button {
            flex-grow: 1;
            background-color: #f0f0f0;
            color: var(--color-text-dark);
            box-shadow: none;
            margin: 0 5px;
            border: 1px solid #ddd;
        }

        .tab-buttons button.active-tab {
            background-color: var(--color-orange);
            color: var(--color-text-light);
            border: 1px solid var(--color-orange);
        }

        .login-mascot-placeholder {
            text-align: center;
            margin-bottom: 20px;
            font-size: 3em;
            animation: float 3s infinite alternate;
        }

        @keyframes float {
            0% { transform: translateY(0); }
            100% { transform: translateY(-10px); }
        }

        .forgot-links {
            text-align: center;
            margin: 15px 0;
        }

        .forgot-links a {
            color: var(--color-orange);
            text-decoration: none;
            font-size: 0.9em;
            margin: 0 10px;
        }

        .forgot-links a:hover {
            text-decoration: underline;
        }

        /*
        =========================================================
        4. Child Home Page Styles
        =========================================================
        */
        #child-home-screen {
            padding: 0; /* Full screen interface */
            background-color: var(--color-cream);
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            overflow-y: auto;
            box-sizing: border-box;
        }

        #child-home-screen .home-content {
            padding: 20px;
            max-width: none;
            margin: 0;
        }
        
        /* New Secret Lock Button */
        .secret-lock-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.7);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.2em;
            cursor: pointer;
            z-index: 50;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: opacity 0.3s, transform 0.1s;
            opacity: 0.2; /* Hidden/Subtle look */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .secret-lock-btn:hover,
        .secret-lock-btn:focus {
            opacity: 1; /* Reveals on hover/tap */
            transform: scale(1.1);
        }
        
        .secret-lock-btn:active {
             transform: scale(0.95);
        }

        .home-content {
            padding: 20px;
            flex-grow: 1;
            overflow-y: auto;
            /* Confetti/Bubbles Animation Placeholder */
            background-image: radial-gradient(circle, rgba(255, 255, 255, 0.5) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: backgroundFlow 60s linear infinite;
        }

        @keyframes backgroundFlow {
            from { background-position: 0 0; }
            to { background-position: 100vw 100vh; }
        }

        .video-card {
            background-color: var(--color-orange);
            color: var(--color-text-light);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .play-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: white;
            color: var(--color-orange);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: transform 0.1s;
        }
        
        .play-button:active {
            transform: scale(0.9);
        }

        .activity-grid {
            display: grid;
            /* 2 columns on mobile, scaling up to 4 or more on desktop */
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
            gap: 15px;
        }

        .activity-card {
            background-color: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            font-size: 0.9em;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.1s;
            cursor: pointer;
            border: 2px solid #fff;
            overflow: hidden; /* To contain background color spill */
        }
        
        .activity-card:active {
            transform: scale(0.95);
        }

        .activity-card-icon {
            font-size: 3em;
            margin-bottom: 5px;
            display: inline-block;
            animation: slightBounce 5s infinite;
            padding: 5px;
            border-radius: 10px;
            box-shadow: 0 3px 6px rgba(255, 255, 255, 0.3); /* Lighter shadow to make icon pop */
            background-color: rgba(255, 255, 255, 0.8);
        }

        @keyframes slightBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /*
        =========================================================
        5. Video Gallery Styles
        =========================================================
        */
        .video-gallery-screen {
            background-color: var(--color-soft-green);
            max-width: 100%;
            margin: 0 auto;
        }

        .video-gallery-header {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 30px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .video-item {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .video-item:hover {
            transform: translateY(-5px);
        }

        .video-thumbnail {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            background: #000;
        }

        .video-thumbnail iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-title {
            padding: 15px;
            font-weight: bold;
            text-align: center;
            background: var(--color-cream);
            margin: 0;
        }

        /*
        =========================================================
        6. Parent Dashboard Styles
        =========================================================
        */
        #parent-dashboard-screen, #game-screen, #drawing-screen, #ai-story-screen {
            background-color: var(--color-soft-green);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .dashboard-card {
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            border-left: 5px solid var(--color-orange);
        }

        /* Drawing Canvas specific styles */
        #drawing-screen {
            background: linear-gradient(135deg, var(--color-light-pink), var(--color-pastel-blue));
            max-width: none;
            width: 100%;
            height: 100vh;
            padding: 20px;
        }

        #drawing-screen .dashboard-header {
            margin-bottom: 15px;
        }

        #drawing-canvas {
            background-color: #ffffff;
            border-radius: 10px;
            border: 5px dashed var(--color-light-pink);
            touch-action: none; /* Crucial for better touch drawing */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        /* AI Storyteller Styles */
        #ai-story-screen {
            background: linear-gradient(135deg, var(--color-story-purple), var(--color-pastel-blue));
        }

        .story-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .story-input-container input {
            flex: 1;
            margin-bottom: 0;
        }

        .story-output {
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid var(--color-story-purple);
            line-height: 1.6;
        }

        .loading-dots {
            display: inline-block;
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /*
        =========================================================
        7. Modal Styles (Reusable for Video/Passcode)
        =========================================================
        */
        .custom-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .custom-modal.visible {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: scale(0.95);
            transition: transform 0.3s;
            position: relative;
        }

        .custom-modal.visible .modal-content {
            transform: scale(1);
        }
        
        /* Video Modal Specific */
        #video-modal .modal-content {
            background-color: #000;
            max-width: 90vw;
            width: 90vw;
            padding: 0;
            border-left: none;
        }
        
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            border-radius: 20px;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            z-index: 10;
        }

        /* Photo Upload Styles */
        .photo-upload-container {
            text-align: center;
            margin: 15px 0;
        }

        .photo-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: var(--color-cream);
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 3px solid var(--color-orange);
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-upload-btn {
            background-color: var(--color-pastel-blue);
            color: var(--color-text-dark);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            display: inline-block;
            font-size: 0.9em;
        }

        /* Professional Header Styles */
        .site-header {
            background-color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .site-logo {
            font-size: 1.5em;
            font-weight: 900;
            color: var(--color-orange);
            text-decoration: none;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-greeting {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--color-text-dark);
        }

        .logout-btn {
            background-color: var(--color-cream);
            color: var(--color-orange);
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        .logout-btn:hover {
            background-color: var(--color-orange);
            color: white;
        }

        /* Layout Styles */
        .home-content {
            display: flex;
            gap: 30px;
            padding: 30px 20px;
            max-width: 1400px;
            margin: 0 auto;
            /* Confetti/Bubbles Animation Placeholder */
            background-image: radial-gradient(circle, rgba(255, 255, 255, 0.5) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: backgroundFlow 60s linear infinite;
        }

        .main-content {
            flex: 1;
            min-width: 0;
        }

        .sidebar {
            width: 300px;
            flex-shrink: 0;
        }

        .section-header {
            margin-bottom: 20px;
            text-align: center;
        }

        .section-header h2 {
            margin-bottom: 5px;
            font-size: 1.4em;
        }

        .section-header p {
            color: #666;
            font-size: 0.9em;
        }

        /* Activity Streak in Sidebar */
        .activity-streak {
            text-align: center;
            margin-bottom: 20px;
        }

        .streak-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        /* Footer Styles */
        .site-footer {
            background-color: white;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #eee;
            margin-top: auto;
        }

        .footer-content p {
            margin: 0;
            color: #666;
            font-size: 0.9em;
        }

        /* Responsive Adjustments for New Layout */
        @media (max-width: 1024px) {
            .home-content {
                flex-direction: column;
                gap: 20px;
            }

            .sidebar {
                width: 100%;
            }

            .site-header {
                padding: 10px 15px;
            }

            .header-content {
                flex-direction: column;
                gap: 10px;
            }

            .user-info {
                justify-content: space-between;
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .site-logo {
                font-size: 1.2em;
            }

            .user-greeting {
                font-size: 1em;
            }

            .logout-btn {
                padding: 6px 12px;
                font-size: 0.8em;
            }

            .home-content {
                padding: 20px 15px;
            }

            .section-header h2 {
                font-size: 1.2em;
            }
        }

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <!-- 1. Splash Screen -->
    <div id="splash-screen" class="app-screen active">
        <div class="splash-logo">‡∞Ö... ‡∞Ü...</div>
        <div class="splash-lottie-placeholder">
            [Lottie Animation Placeholder]<br>üßë‚Äçüë©‚Äçüëß‚Äçüë¶
        </div>
        <p class="splash-tagline">
            A secure, fun, and educational digital world for kids ‚Äî guided by parents, inspired by Indian stories.
        </p>
        <button class="btn btn-primary" onclick="navigate('login-screen')">
            Enter
        </button>
    </div>

    <!-- 2. Login Screen -->
    <div id="login-screen" class="app-screen">
        <h2 style="text-align: center;">Welcome Back!</h2>
        <div class="login-card">
            <div class="login-mascot-placeholder">
                üòä
            </div>
            
            <div class="tab-buttons">
                <button class="btn active-tab" onclick="switchTab('login')">Login</button>
                <button class="btn" onclick="switchTab('signup')">Sign Up</button>
            </div>

            <!-- Login Form -->
            <form id="login-form" class="auth-form">
                <input type="email" placeholder="Email" required id="login-email">
                <input type="password" placeholder="Password" required id="login-password">
                <p id="login-error-message" style="color: red; text-align: center; margin-top: -10px; margin-bottom: 10px; display: none;">Invalid credentials.</p>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Log In
                </button>
            </form>

            <!-- Signup Form -->
            <form id="signup-form" class="auth-form" style="display: none;">
                <div class="photo-upload-container">
                    <div class="photo-preview" id="photo-preview">
                        üë∂
                    </div>
                    <input type="file" id="photo-upload" accept="image/*" style="display: none;" onchange="previewPhoto(event)">
                    <label for="photo-upload" class="photo-upload-btn">Upload Photo</label>
                </div>
                
                <input type="text" placeholder="Child's Name" required id="child-name">
                <input type="number" placeholder="Child's Age" required id="child-age" min="3" max="12">
                <select id="child-grade" required>
                    <option value="">Select Grade</option>
                    <option value="pre-k">Pre-K</option>
                    <option value="kindergarten">Kindergarten</option>
                    <option value="1st">1st Grade</option>
                    <option value="2nd">2nd Grade</option>
                    <option value="3rd">3rd Grade</option>
                    <option value="4th">4th Grade</option>
                    <option value="5th">5th Grade</option>
                </select>
                <input type="email" placeholder="Parent's Email" required id="parent-email">
                <input type="password" placeholder="Create Password" required id="signup-password">
                <input type="password" placeholder="Confirm Password" required id="confirm-password">
                <p id="signup-error-message" style="color: red; text-align: center; margin-top: -10px; margin-bottom: 10px; display: none;">Passwords don't match.</p>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Create Account
                </button>
            </form>
            
            <div class="forgot-links">
                <a href="#" onclick="showForgotPassword()">Forgot Password?</a>
                <a href="#" onclick="showForgotParentGate()">Forgot Parent Gate?</a>
            </div>
        </div>
    </div>

    <!-- 3. Child Home Screen -->
    <div id="child-home-screen" class="app-screen">
        <!-- Professional Header -->
        <header class="site-header">
            <div class="header-content">
                <a href="#" class="site-logo">‡∞Ö... ‡∞Ü...</a>
                <div class="user-info">
                    <span class="user-greeting">‡∞®‡∞Æ‡∞∏‡±ç‡∞§‡±á, <span id="child-greeting">‡∞ö‡∞ø‡∞ü‡±ç‡∞ü‡∞ø</span>! üëã</span>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>
        </header>

        <!-- New Secret Parent Lock in the top-right corner -->
        <button class="secret-lock-btn" onclick="promptParentPassword()" aria-label="Parent Access">
            üîí
        </button>

        <div class="home-content">
            <div class="main-content">
                <!-- Featured Video Section -->
                <div class="video-card" onclick="openActivity('featured')">
                    <div>
                        <h2>Today's Featured Video</h2>
                        <p>Fun learning playlist awaits!</p>
                    </div>
                    <div class="play-button">
                        ‚ñ∂
                    </div>
                </div>

                <!-- SECTION 1: LEARNING ZONES -->
                <div class="section-header">
                    <h2>Learning Zones</h2>
                    <p>Explore different subjects and expand your knowledge</p>
                </div>

                <div class="activity-grid">
                    <!-- 1. Telugu Alphabets -->
                    <div class="activity-card" onclick="openActivity('telugu')">
                        <span class="activity-card-icon" style="background-color: var(--color-cream);">‚úçÔ∏è</span>
                        <div>Telugu Alphabets</div>
                    </div>
                    <!-- 2. English Grammar/Alphabets -->
                    <div class="activity-card" onclick="openActivity('grammar')">
                        <span class="activity-card-icon" style="background-color: var(--color-grammar-blue);">üÖ∞Ô∏è</span>
                        <div>English Grammar</div>
                    </div>
                    <!-- 3. Kids Stories -->
                    <div class="activity-card" onclick="openActivity('stories')">
                        <span class="activity-card-icon" style="background-color: var(--color-soft-green);">üìö</span>
                        <div>Kids Stories</div>
                    </div>
                    <!-- 4. Maths -->
                    <div class="activity-card" onclick="openActivity('maths')">
                        <span class="activity-card-icon" style="background-color: var(--color-maths-yellow);">üî¢</span>
                        <div>Maths</div>
                    </div>
                    <!-- 5. History -->
                    <div class="activity-card" onclick="openActivity('history')">
                        <span class="activity-card-icon" style="background-color: var(--color-history-lavender);">üëë</span>
                        <div>History</div>
                    </div>
                    <!-- 6. Science -->
                    <div class="activity-card" onclick="openActivity('science')">
                        <span class="activity-card-icon" style="background-color: var(--color-science-green);">üß™</span>
                        <div>Science</div>
                    </div>
                    <!-- 7. Ramayana -->
                    <div class="activity-card" onclick="openActivity('ramayana')">
                        <span class="activity-card-icon" style="background-color: var(--color-epic-red); color: white; border-color: var(--color-epic-red);">üèπ</span>
                        <div style="color: var(--color-epic-red); font-weight: 700;">Ramayana</div>
                    </div>
                    <!-- 8. Mahabharata -->
                    <div class="activity-card" onclick="openActivity('mahabharata')">
                        <span class="activity-card-icon" style="background-color: var(--color-orange); color: white; border-color: var(--color-orange);">‚öîÔ∏è</span>
                        <div style="color: var(--color-orange); font-weight: 700;">Mahabharata</div>
                    </div>
                </div>

                <!-- SECTION 2: E-LEARNING (New Section) -->
                <div class="section-header">
                    <h2>E-Learning</h2>
                    <p>Interactive online learning experiences</p>
                </div>

                <div class="activity-grid">
                    <!-- E-Learning Card -->
                    <div class="activity-card" onclick="openActivity('elearning')">
                        <span class="activity-card-icon" style="background-color: var(--color-elearning-teal); color: white;">üíª</span>
                        <div style="color: var(--color-elearning-teal); font-weight: 700;">E-Learning</div>
                    </div>
                </div>

                <!-- SECTION 3: FUN & CREATIVE ZONES -->
                <div class="section-header">
                    <h2>Fun & Creative Zones</h2>
                    <p>Unleash your creativity and have fun learning</p>
                </div>

                <div class="activity-grid">
                    <!-- Puzzles & Games -->
                    <div class="activity-card" onclick="openActivity('puzzles_games')">
                        <span class="activity-card-icon" style="background-color: var(--color-pastel-blue);">üß©</span>
                        <div>Puzzles & Games</div>
                    </div>
                    <!-- Drawing -->
                    <div class="activity-card" onclick="openActivity('drawing')">
                        <span class="activity-card-icon" style="background-color: var(--color-light-pink);">üé®</span>
                        <div>Drawing</div>
                    </div>
                    <!-- AI Storyteller -->
                    <div class="activity-card" onclick="openActivity('ai_storyteller')">
                        <span class="activity-card-icon" style="background-color: var(--color-story-purple); color: white;">ü§ñ</span>
                        <div style="color: var(--color-story-purple); font-weight: 700;">AI Storyteller</div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <aside class="sidebar">
                <h3>Activity Streak</h3>
                <div class="activity-streak">
                    <div class="streak-icon">‚≠ê</div>
                    <p>Keep up the great work! You've been active for <strong>3 days</strong> in a row!</p>
                </div>

                <h3>Quick Stats</h3>
                <div class="dashboard-card">
                    <p><strong>Videos Watched:</strong> 12</p>
                    <p><strong>Time Spent:</strong> 2.5 hours</p>
                    <p><strong>Favorite Subject:</strong> Stories</p>
                </div>

                <h3>Parent Controls</h3>
                <button class="btn btn-secondary" onclick="promptParentPassword()" style="width: 100%; margin-bottom: 10px;">
                    Parent Dashboard
                </button>
            </aside>
        </div>

        <!-- Footer -->
        <footer class="site-footer">
            <div class="footer-content">
                <p>&copy; 2024 KidSpace. A secure learning environment for children. Made with ‚ù§Ô∏è for Indian kids.</p>
            </div>
        </footer>
    </div>

    <!-- 4. Parent Dashboard Screen -->
    <div id="parent-dashboard-screen" class="app-screen">
        <div class="dashboard-header">
            <h1 style="color: var(--color-orange); font-size: 2em;">Parent Dashboard üõ°Ô∏è</h1>
            <button class="btn btn-secondary" onclick="navigate('child-home-screen')">
                Back to Kiddo
            </button>
        </div>
        
        <h2 style="color: var(--color-text-dark);">Usage Statistics</h2>
        <div class="dashboard-card">
            <p><strong>Total Screen Time Today:</strong> 45 minutes</p>
            <p><strong>Most Watched:</strong> Telugu Story Time Playlist</p>
        </div>
        
        <h2 style="color: var(--color-text-dark);">Content Management</h2>
        <div class="dashboard-card">
            <h3 style="font-size: 1.2em; font-weight: bold; margin-bottom: 10px;">Approved Playlists</h3>
            <ul style="list-style: disc; margin-left: 20px;">
                <li>Rhymes & Songs</li>
                <li>Letter Tracing Practice</li>
                <li>Moral Stories (Ramayana & Mahabharata)</li>
            </ul>
        </div>
    </div>

    <!-- 5. Puzzles & Games Screen -->
    <div id="game-screen" class="app-screen">
        <div class="dashboard-header" style="justify-content: flex-start;">
            <button class="btn btn-secondary" onclick="navigate('child-home-screen')" style="margin-right: 20px;">
                &larr; Back
            </button>
            <h1 style="color: var(--color-orange); font-size: 2em;">Puzzles & Games üß©</h1>
        </div>
        
        <div class="dashboard-card" style="text-align: center; padding: 50px;">
            <p style="font-size: 1.2em; font-weight: bold;">
                Welcome to the Fun Zone!
            </p>
            <p>This is where we'd embed fun, interactive HTML5 games and puzzles for your child. In a full application, this would contain the actual game content.</p>
            <p style="margin-top: 20px; font-weight: 700;">[Placeholder: Interactive Game Content Area]</p>
        </div>
    </div>

    <!-- 6. Drawing Screen -->
    <div id="drawing-screen" class="app-screen">
        <div class="dashboard-header" style="justify-content: flex-start; max-width: 800px; margin: 0 auto 30px;">
            <button class="btn btn-secondary" onclick="navigate('child-home-screen')" style="margin-right: 20px;">
                &larr; Back
            </button>
            <h1 style="color: var(--color-orange); font-size: 2em;">Drawing Canvas üé®</h1>
        </div>

        <div style="flex-grow: 1; display: flex; align-items: stretch; justify-content: center; max-width: 800px; width: 100%; margin: 0 auto;">
            <canvas id="drawing-canvas"></canvas>
        </div>
    </div>

    <!-- 7. AI Storyteller Screen -->
    <div id="ai-story-screen" class="app-screen">
        <div class="dashboard-header" style="justify-content: flex-start; max-width: 800px; margin: 0 auto 30px;">
            <button class="btn btn-secondary" onclick="navigate('child-home-screen')" style="margin-right: 20px;">
                &larr; Back
            </button>
            <h1 style="color: var(--color-story-purple); font-size: 2em;">AI Storyteller ü§ñ</h1>
        </div>

        <div style="max-width: 800px; width: 100%; margin: 0 auto;">
            <div class="dashboard-card">
                <h3 style="color: var(--color-story-purple); margin-bottom: 15px;">Create Your Own Story!</h3>
                <p>Tell me what kind of story you want, and I'll create a magical adventure for you!</p>
                
                <div class="story-input-container">
                    <input type="text" id="story-prompt" placeholder="e.g., A story about a brave little tiger..." maxlength="100">
                    <button class="btn btn-primary" onclick="generateStory()">Create Story</button>
                </div>
                
                <div class="story-output" id="story-output">
                    Your story will appear here... Once upon a time...
                </div>
            </div>
        </div>
    </div>

    <!-- 8. E-Learning Screen -->
    <div id="elearning-screen" class="app-screen video-gallery-screen">
        <div class="video-gallery-header">
            <button class="btn btn-secondary" onclick="navigate('child-home-screen')" style="margin-right: 20px;">
                &larr; Back
            </button>
            <h1 style="color: var(--color-elearning-teal); font-size: 2em;">E-Learning üíª</h1>
        </div>
        <div class="video-grid" id="elearning-video-grid">
            <!-- Videos will be inserted here by JavaScript -->
        </div>
    </div>

    <!-- Video Gallery Screens -->
    <div id="telugu-videos" class="app-screen video-gallery-screen">
        <div class="video-gallery-header">
            <button class="btn btn-secondary" onclick="navigate('child-home-screen')" style="margin-right: 20px;">
                &larr; Back
            </button>
            <h1 style="color: var(--color-cream); font-size: 2em;">Telugu Alphabets ‚úçÔ∏è</h1>
        </div>
        <div class="video-grid" id="telugu-video-grid">
            <!-- Videos will be inserted here by JavaScript -->
        </div>
    </div>

    <div id="grammar-videos" class="app-screen video-gallery-screen">
        <div class="video-gallery-header">
            <button class="btn btn-secondary" onclick="navigate('child-home-screen')" style="margin-right: 20px;">
                &larr; Back
            </button>
            <h1 style="color: var(--color-grammar-blue); font-size: 2em;">English Grammar üÖ∞Ô∏è</h1>
        </div>
        <div class="video-grid" id="grammar-video-grid">
            <!-- Videos will be inserted here by JavaScript -->
        </div>
    </div>

    <div id="stories-videos" class="app-screen video-gallery-screen">
        <div class="video-gallery-header">
            <button class="btn btn-secondary" onclick="navigate('child-home-screen')" style="margin-right: 20px;">
                &larr; Back
            </button>
            <h1 style="color: var(--color-soft-green); font-size: 2em;">Kids Stories üìö</h1>
        </div>
        <div class="video-grid" id="stories-video-grid">
            <!-- Videos will be inserted here by JavaScript -->
        </div>
    </div>

    <div id="maths-videos" class="app-screen video-gallery-screen">
        <div class="video-gallery-header">
            <button class="btn btn-secondary" onclick="navigate('child-home-screen')" style="margin-right: 20px;">
                &larr; Back
            </button>
            <h1 style="color: var(--color-maths-yellow); font-size: 2em;">Maths üî¢</h1>
        </div>
        <div class="video-grid" id="maths-video-grid">
            <!-- Videos will be inserted here by JavaScript -->
        </div>
    </div>

    <div id="history-videos" class="app-screen video-gallery-screen">
        <div class="video-gallery-header">
            <button class="btn btn-secondary" onclick="navigate('child-home-screen')" style="margin-right: 20px;">
                &larr; Back
            </button>
            <h1 style="color: var(--color-history-lavender); font-size: 2em;">History Videos üëë</h1>
        </div>
        <div class="video-grid" id="history-video-grid">
            <!-- Videos will be inserted here by JavaScript -->
        </div>
    </div>

    <div id="science-videos" class="app-screen video-gallery-screen">
        <div class="video-gallery-header">
            <button class="btn btn-secondary" onclick="navigate('child-home-screen')" style="margin-right: 20px;">
                &larr; Back
            </button>
            <h1 style="color: var(--color-science-green); font-size: 2em;">Science Videos üß™</h1>
        </div>
        <div class="video-grid" id="science-video-grid">
            <!-- Videos will be inserted here by JavaScript -->
        </div>
    </div>

    <div id="ramayana-videos" class="app-screen video-gallery-screen">
        <div class="video-gallery-header">
            <button class="btn btn-secondary" onclick="navigate('child-home-screen')" style="margin-right: 20px;">
                &larr; Back
            </button>
            <h1 style="color: var(--color-epic-red); font-size: 2em;">Ramayana Videos üèπ</h1>
        </div>
        <div class="video-grid" id="ramayana-video-grid">
            <!-- Videos will be inserted here by JavaScript -->
        </div>
    </div>

    <div id="mahabharata-videos" class="app-screen video-gallery-screen">
        <div class="video-gallery-header">
            <button class="btn btn-secondary" onclick="navigate('child-home-screen')" style="margin-right: 20px;">
                &larr; Back
            </button>
            <h1 style="color: var(--color-orange); font-size: 2em;">Mahabharata Videos ‚öîÔ∏è</h1>
        </div>
        <div class="video-grid" id="mahabharata-video-grid">
            <!-- Videos will be inserted here by JavaScript -->
        </div>
    </div>

    <!-- MODALS -->

    <!-- Custom Message Box -->
    <div id="custom-message-modal" class="custom-modal" role="dialog" aria-modal="true" aria-labelledby="message-title">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeModal('custom-message-modal')">&times;</button>
            <h3 id="message-title" style="color: var(--color-orange); margin-bottom: 10px; text-align: center;">Heads Up!</h3>
            <p id="custom-message-text" style="text-align: center; margin-bottom: 20px;">Default message.</p>
            <button class="btn btn-primary" style="width: 100%;" onclick="closeModal('custom-message-modal')">Got It</button>
        </div>
    </div>

    <!-- Parent Passcode Modal -->
    <div id="passcode-modal" class="custom-modal" role="dialog" aria-modal="true" aria-labelledby="passcode-title">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeModal('passcode-modal')">&times;</button>
            <h3 id="passcode-title" style="color: var(--color-orange); margin-bottom: 10px; text-align: center;">Parent Gate üõ°Ô∏è</h3>
            <p style="text-align: center; margin-size: 0.9em; margin-bottom: 15px;">Enter the 4-digit password to continue.</p>
            
            <input type="password" id="parent-password-input" placeholder="Enter Passcode" maxlength="4" style="text-align: center;">
            <p id="passcode-error" style="color: red; text-align: center; margin-top: -10px; margin-bottom: 10px; display: none;">Incorrect password.</p>
            
            <div class="forgot-links">
                <a href="#" onclick="showForgotParentGate()">Forgot Parent Gate?</a>
            </div>
            
            <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="handlePasscodeSubmit()">Unlock</button>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgot-password-modal" class="custom-modal" role="dialog" aria-modal="true">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeModal('forgot-password-modal')">&times;</button>
            <h3 style="color: var(--color-orange); margin-bottom: 10px; text-align: center;">Reset Password</h3>
            <p style="text-align: center; margin-bottom: 15px;">Enter your email to receive password reset instructions.</p>
            
            <input type="email" id="reset-email" placeholder="Enter your email" style="text-align: center;">
            <p id="reset-success" style="color: green; text-align: center; margin-top: -10px; margin-bottom: 10px; display: none;">Reset instructions sent!</p>
            
            <button class="btn btn-primary" style="width: 100%;" onclick="handlePasswordReset()">Send Reset Link</button>
        </div>
    </div>

    <!-- Forgot Parent Gate Modal -->
    <div id="forgot-parentgate-modal" class="custom-modal" role="dialog" aria-modal="true">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeModal('forgot-parentgate-modal')">&times;</button>
            <h3 style="color: var(--color-orange); margin-bottom: 10px; text-align: center;">Reset Parent Gate</h3>
            <p style="text-align: center; margin-bottom: 15px;">Enter your parent email to reset the Parent Gate passcode.</p>
            
            <input type="email" id="parentgate-email" placeholder="Enter parent email" style="text-align: center;">
            <p id="parentgate-success" style="color: green; text-align: center; margin-top: -10px; margin-bottom: 10px; display: none;">Reset instructions sent!</p>
            
            <button class="btn btn-primary" style="width: 100%;" onclick="handleParentGateReset()">Send Reset Link</button>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const SCREENS = {
            'splash-screen': 'splash-screen',
            'login-screen': 'login-screen',
            'child-home-screen': 'child-home-screen',
            'parent-dashboard-screen': 'parent-dashboard-screen',
            'game-screen': 'game-screen',
            'drawing-screen': 'drawing-screen',
            'ai-story-screen': 'ai-story-screen',
            'elearning-screen': 'elearning-screen',
            'telugu-videos': 'telugu-videos',
            'grammar-videos': 'grammar-videos',
            'stories-videos': 'stories-videos',
            'maths-videos': 'maths-videos',
            'history-videos': 'history-videos',
            'science-videos': 'science-videos',
            'ramayana-videos': 'ramayana-videos',
            'mahabharata-videos': 'mahabharata-videos'
        };

        // Video data for each category
        const VIDEO_DATA = {
            'telugu': [
                { id: 'iXYleETEiYo', title: 'Telugu Alphabets Part 1' },
                { id: 'DyCm_xBLe7U', title: 'Telugu Alphabets Part 2' },
                { id: 'DyCm_xBLe7U', title: 'Telugu Writing Practice' }
            ],
            'grammar': [
                { id: 'QahSR-a6raQ', title: 'Basic English Grammar' },
                { id: 'f2638snImhI', title: 'Grammar for Kids' },
                { id: '-4CL3Xn-ycw', title: 'English Sentences' },
                { id: 'ccEpTTZW34g', title: 'Fun with Grammar' }
            ],
            'stories': [
                { id: 'DZAB2Dpztp4', title: 'Moral Stories for Kids' },
                { id: 'IvBUX6JIv7w', title: 'Bedtime Stories' },
                { id: 'f6_sBjLRi7E', title: 'Animal Stories' },
                { id: 'i8-Qip64RNw', title: 'Fairy Tales' },
                { id: 'O5M6VXXaCdE', title: 'Adventure Stories' }
            ],
            'maths': [
                { id: 'QcibLMpBDWg', title: 'Basic Counting' },
                { id: 'hlVmO01LCRk', title: 'Addition for Kids' },
                { id: '0UEzj2ta5Wo', title: 'Subtraction Fun' },
                { id: 'garwCSnpNhI', title: 'Shapes and Patterns' }
            ],
            'history': [
                { id: 'Dntu8vy4G7c', title: 'Ancient Civilizations' },
                { id: '4S-eQIL8xVQ', title: 'Great Kings of India' },
                { id: '3auYQuu_XnA', title: 'Historical Monuments' },
                { id: 'cLJRs3YOlL8', title: 'Freedom Fighters' },
                { id: 'Bo7JvJMQR2Q', title: 'Indian Culture Heritage' }
            ],
            'science': [
                { id: '3FwJjsJQLT8', title: 'Fun Science Experiments' },
                { id: 'hT3IVdwsvJM', title: 'Solar System Adventure' },
                { id: 'E45BSndrhuo', title: 'Amazing Animals' },
                { id: 'jFsZ4QNIxNY', title: 'Water Cycle Magic' },
                { id: 'aUDENstXRFM', title: 'Plant Life Cycle' }
            ],
            'ramayana': [
                { id: '1UYLjVPgNPc', title: 'Birth of Lord Rama' },
                { id: 'iWpq9Nc5B6g', title: 'Rama and Sita Story' },
                { id: 'Vk_OYQ3aNBI', title: 'Hanuman Adventures' },
                { id: 'THhn4NOG3tM', title: 'Battle of Lanka' },
                { id: '9zzu2qVpOUY', title: 'Return to Ayodhya' }
            ],
            'mahabharata': [
                { id: 'HMHrnD8nAjA', title: 'Pandavas and Kauravas' },
                { id: 'HJsLqLzPa6k', title: 'Bhagavad Gita Lessons' },
                { id: '2-9XC-YPGvM', title: 'Great Warriors' },
                { id: 'XNmw-NgAPco', title: 'Kurukshetra War' },
                { id: 'Ph4MfownyXY', title: 'Moral Stories' }
            ],
            'elearning': [
                { id: 'iXYleETEiYo', title: 'Interactive Learning' },
                { id: 'QahSR-a6raQ', title: 'Digital Classroom' },
                { id: 'DZAB2Dpztp4', title: 'Online Education' },
                { id: 'QcibLMpBDWg', title: 'E-Learning Tools' }
            ]
        };

        // IMPORTANT: These are placeholder IDs/Configurations.
        const PLAYLIST_CONFIG = {
            'telugu': { screenId: 'telugu-videos', title: 'Telugu Alphabets', type: 'screen' },
            'grammar': { screenId: 'grammar-videos', title: 'English Grammar', type: 'screen' },
            'stories': { screenId: 'stories-videos', title: 'Kids Stories', type: 'screen' },
            'maths': { screenId: 'maths-videos', title: 'Maths', type: 'screen' },
            'history': { screenId: 'history-videos', title: 'History', type: 'screen' },
            'science': { screenId: 'science-videos', title: 'Science', type: 'screen' },
            'ramayana': { screenId: 'ramayana-videos', title: 'Ramayana', type: 'screen' },
            'mahabharata': { screenId: 'mahabharata-videos', title: 'Mahabharata', type: 'screen' },
            'elearning': { screenId: 'elearning-screen', title: 'E-Learning', type: 'screen' },
            'ai_storyteller': { screenId: 'ai-story-screen', title: 'AI Storyteller', type: 'screen' },
            'puzzles_games': { screenId: 'game-screen', title: 'Puzzles & Games', type: 'screen' },
            'drawing': { screenId: 'drawing-screen', title: 'Drawing', type: 'screen' },
            'featured': { id: 'S2pP-5gXp1M', title: "Today's Featured", type: 'video', isPlaylist: false } 
        };

        // User data storage
        let userData = JSON.parse(localStorage.getItem('kidspace_user')) || null;
        let parentPassword = localStorage.getItem('kidspace_parent_password') || "1234";

        // --- NAVIGATION ---
        const navigate = (targetId) => {
            Object.values(SCREENS).forEach(id => {
                const screen = document.getElementById(id);
                if (screen) {
                    screen.classList.remove('active');
                }
            });
            
            const targetScreen = document.getElementById(targetId);
            if (targetScreen) {
                targetScreen.classList.add('active');
                
                // Load videos when navigating to video galleries
                if (targetId.includes('videos') || targetId === 'elearning-screen') {
                    loadVideosForCategory(targetId.replace('-screen', '').replace('-videos', ''));
                }
            }
        };

        // --- LOAD VIDEOS ---
        const loadVideosForCategory = (category) => {
            const screenId = category === 'elearning' ? 'elearning-screen' : `${category}-videos`;
            const videoGrid = document.getElementById(`${category}-video-grid`);
            const videos = VIDEO_DATA[category];
            
            if (videoGrid && videos) {
                videoGrid.innerHTML = '';
                videos.forEach(video => {
                    const videoItem = document.createElement('div');
                    videoItem.className = 'video-item';
                    videoItem.innerHTML = `
                        <div class="video-thumbnail">
                            <iframe 
                                src="https://www.youtube.com/embed/${video.id}" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                            </iframe>
                        </div>
                        <h3 class="video-title">${video.title}</h3>
                    `;
                    videoGrid.appendChild(videoItem);
                });
            }
        };

        // --- TAB SWITCHING ---
        const switchTab = (tab) => {
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const loginTab = document.querySelector('.tab-buttons button:nth-child(1)');
            const signupTab = document.querySelector('.tab-buttons button:nth-child(2)');
            
            if (tab === 'login') {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
                loginTab.classList.add('active-tab');
                signupTab.classList.remove('active-tab');
            } else {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
                loginTab.classList.remove('active-tab');
                signupTab.classList.add('active-tab');
            }
        };

        // --- CUSTOM MODAL HANDLERS ---
        const showCustomMessage = (message) => {
            document.getElementById('custom-message-text').textContent = message;
            showModal('custom-message-modal');
        };

        const showModal = (modalId) => {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('visible');
            }
        };

        const closeModal = (modalId) => {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('visible');
            }
        };

        // --- PHOTO UPLOAD ---
        const previewPhoto = (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('photo-preview');
                    preview.innerHTML = `<img src="${e.target.result}" alt="Child photo">`;
                };
                reader.readAsDataURL(file);
            }
        };

        // --- FORGOT PASSWORD/PARENT GATE ---
        const showForgotPassword = () => {
            closeModal('passcode-modal');
            showModal('forgot-password-modal');
        };

        const showForgotParentGate = () => {
            closeModal('passcode-modal');
            showModal('forgot-parentgate-modal');
        };

        const handlePasswordReset = () => {
            const email = document.getElementById('reset-email').value;
            if (email) {
                document.getElementById('reset-success').style.display = 'block';
                setTimeout(() => {
                    closeModal('forgot-password-modal');
                    showCustomMessage('Password reset instructions have been sent to your email.');
                }, 1000);
            }
        };

        const handleParentGateReset = () => {
            const email = document.getElementById('parentgate-email').value;
            if (email) {
                document.getElementById('parentgate-success').style.display = 'block';
                setTimeout(() => {
                    closeModal('forgot-parentgate-modal');
                    showCustomMessage('Parent Gate reset instructions have been sent to your email.');
                }, 1000);
            }
        };

        // --- VIDEO / ACTIVITY LAUNCHER ---
        const openVideoOrPlaylistModal = (id, isPlaylist = true) => {
            const iframe = document.getElementById('video-iframe');
            let embedUrl = '';
            
            if (isPlaylist) {
                embedUrl = `https://www.youtube.com/embed/videoseries?list=${id}&autoplay=1`;
            } else {
                embedUrl = `https://www.youtube.com/embed/${id}?autoplay=1`;
            }

            iframe.src = embedUrl;
            showModal('video-modal');
        };
        
        const openActivity = (categoryKey) => {
            const config = PLAYLIST_CONFIG[categoryKey];
            if (!config) {
                 showCustomMessage('The content for this activity zone is currently unavailable.');
                 return;
            }

            if (config.type === 'video') {
                const isPlaylist = config.isPlaylist !== false; 
                openVideoOrPlaylistModal(config.id, isPlaylist);
            } else if (config.type === 'screen') {
                navigate(config.screenId);
                if (config.screenId === 'drawing-screen') {
                    initDrawingCanvas();
                }
            } else {
                showCustomMessage(`The activity type '${config.type}' is not supported.`);
            }
        };

        // --- AI STORYTELLER ---
        const generateStory = async () => {
            const prompt = document.getElementById('story-prompt').value;
            const output = document.getElementById('story-output');
            
            if (!prompt.trim()) {
                showCustomMessage('Please enter a story idea!');
                return;
            }

            output.innerHTML = 'Creating your magical story<span class="loading-dots"></span>';
            
            try {
                // Replace this with your actual API endpoint
                const response = await fetch('https://api.example.com/generate-story', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer YOUR_API_KEY'
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        childAge: userData?.age || 6,
                        maxLength: 500
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    output.innerHTML = data.story;
                } else {
                    throw new Error('API request failed');
                }
            } catch (error) {
                // Fallback to demo story if API fails
                output.innerHTML = getDemoStory(prompt);
            }
        };

        const getDemoStory = (prompt) => {
            const stories = [
                `Once upon a time, there was a brave little adventurer who loved ${prompt}. They went on an amazing journey through enchanted forests and met magical creatures who became their friends. Together, they learned the importance of kindness and courage.`,
                
                `In a land far away, a curious explorer discovered ${prompt}. This discovery led to the most wonderful adventure, filled with laughter, friendship, and valuable lessons about sharing and caring for others.`,
                
                `There once was a magical friend who could create ${prompt} with just a wave of their hand! They used this special power to bring joy to everyone around them and teach important lessons about using gifts wisely.`
            ];
            
            return stories[Math.floor(Math.random() * stories.length)];
        };

        // --- DRAWING CANVAS LOGIC ---
        const initDrawingCanvas = () => {
             const canvas = document.getElementById('drawing-canvas');
             if (!canvas) return;

             const container = canvas.parentElement;
             canvas.width = container.clientWidth;
             canvas.height = container.clientHeight;

             const ctx = canvas.getContext('2d');
             
             ctx.fillStyle = '#ffffff';
             ctx.fillRect(0, 0, canvas.width, canvas.height);
             
             ctx.font = '24px Quicksand';
             ctx.fillStyle = '#999';
             ctx.textAlign = 'center';
             ctx.fillText('Start Drawing Here! (Tap/Click to draw)', canvas.width / 2, canvas.height / 2);
             
             let isDrawing = false;

             const startDrawing = (e) => {
                 isDrawing = true;
                 ctx.lineWidth = 10;
                 ctx.lineCap = 'round';
                 ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--color-orange'); 
                 
                 const rect = canvas.getBoundingClientRect();
                 const x = (e.clientX || (e.touches && e.touches[0].clientX)) - rect.left;
                 const y = (e.clientY || (e.touches && e.touches[0].clientY)) - rect.top;
                 ctx.beginPath();
                 ctx.moveTo(x, y);
                 draw(e);
             };

             const stopDrawing = () => {
                 isDrawing = false;
                 ctx.beginPath();
             };

             const draw = (e) => {
                 if (!isDrawing) return;
                 
                 const rect = canvas.getBoundingClientRect();
                 const x = (e.clientX || (e.touches && e.touches[0].clientX)) - rect.left;
                 const y = (e.clientY || (e.touches && e.touches[0].clientY)) - rect.top;

                 ctx.lineTo(x, y);
                 ctx.stroke();
                 ctx.beginPath();
                 ctx.moveTo(x, y);
             };
             
             canvas.addEventListener('mousedown', startDrawing);
             window.addEventListener('mouseup', stopDrawing);
             canvas.addEventListener('mousemove', draw);

             canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDrawing(e); });
             window.addEventListener('touchend', stopDrawing);
             canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); });

             window.addEventListener('resize', () => {
                initDrawingCanvas();
             });
        };

        // --- AUTHENTICATION LOGIC ---

        // Login Form
        document.getElementById('login-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorElement = document.getElementById('login-error-message');
            
            const storedUser = JSON.parse(localStorage.getItem('kidspace_user'));
            
            if (storedUser && storedUser.parentEmail === email && storedUser.password === password) {
                errorElement.style.display = 'none';
                userData = storedUser;
                // Update greeting with child's name
                document.getElementById('child-greeting').textContent = userData.childName;
                setTimeout(() => {
                    navigate('child-home-screen');
                }, 500);
            } else {
                errorElement.style.display = 'block';
            }
        });

        // Signup Form
        document.getElementById('signup-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            const errorElement = document.getElementById('signup-error-message');
            
            if (password !== confirmPassword) {
                errorElement.style.display = 'block';
                return;
            }
            
            errorElement.style.display = 'none';
            
            // Save user data
            userData = {
                childName: document.getElementById('child-name').value,
                age: document.getElementById('child-age').value,
                grade: document.getElementById('child-grade').value,
                parentEmail: document.getElementById('parent-email').value,
                password: password,
                photo: document.getElementById('photo-preview').querySelector('img')?.src || null
            };
            
            localStorage.setItem('kidspace_user', JSON.stringify(userData));
            
            // Generate random parent password
            parentPassword = Math.floor(1000 + Math.random() * 9000).toString();
            localStorage.setItem('kidspace_parent_password', parentPassword);
            
            showCustomMessage(`Account created successfully! Your Parent Gate code is: ${parentPassword}`);
            
            setTimeout(() => {
                // Update greeting with child's name
                document.getElementById('child-greeting').textContent = userData.childName;
                navigate('child-home-screen');
            }, 2000);
        });

        // Parent Password Gate
        const promptParentPassword = () => {
            showModal('passcode-modal');
        };

        const handlePasscodeSubmit = () => {
            const input = document.getElementById('parent-password-input');
            const error = document.getElementById('passcode-error');
            
            if (input.value === parentPassword) {
                closeModal('passcode-modal');
                navigate('parent-dashboard-screen');
            } else {
                error.style.display = 'block';
            }
        };

        // Initialize
        window.onload = () => {
            // Directly navigate to child home screen for testing
            navigate('child-home-screen');
        };
    </script>
</body>
</html>